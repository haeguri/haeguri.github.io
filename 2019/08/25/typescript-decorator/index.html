<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 타입스크립트의 Decorator 살펴보기 · Devlog</title><meta name="description" content="타입스크립트의 Decorator 살펴보기 - Haegyun Jung"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://haeguri.github.io/atom.xml" title="Devlog"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/haeguri" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">타입스크립트의 Decorator 살펴보기</h1><div class="post-info">2019년 8월 25일</div><div class="post-content"><p>타입스크립트의 데코레이터를 사용하면 클래스, 프로퍼티, 메서드 등에 이전에는 제공하지 않던 방법으로 새로운 기능을 추가할 수 있습니다. 사실 데코레이터라는 문법은 이미 자바스크립트 표준으로써 논의되고 있는 단계이며 현재는 초안 단계에 있습니다. 자바스크립트를 확장한 언어라고 할 수 있는 타입스크립트에서는 실험적인 기능으로 데코레이터를 제공하고 있습니다. </p>
<h2 id="시작하기"><a href="#시작하기" class="headerlink" title="시작하기"></a>시작하기</h2><p> 데코레이터는 타입스크립트에서도 실험적인 기능으로써 사용할 수 있기 때문에 커맨드 라인이나 <code>tsconfig.json</code> 에서 <code>experimentalDecorators</code> 옵션을 추가해줘야 합니다. 여기에서 <code>target</code> 설정을 <code>ES5</code>로 하는 이유는 뒤에서 다시 살펴보겠습니다. </p>
<h3 id="커맨드-라인"><a href="#커맨드-라인" class="headerlink" title="커맨드 라인"></a>커맨드 라인</h3><pre class=" language-shell"><code class="language-shell">tsc --target ES5 --experimentalDecorators
</code></pre>
<h3 id="tsconfig-json"><a href="#tsconfig-json" class="headerlink" title="tsconfig.json"></a>tsconfig.json</h3><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"ES5"</span><span class="token punctuation">,</span>
        <span class="token property">"experimentalDecorators"</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="살펴보기"><a href="#살펴보기" class="headerlink" title="살펴보기"></a>살펴보기</h2><p> 데코레이터는 앞에서 말한 것처럼 “클래스”, “메서드”, “접근자”, “프로퍼티”, “파라미터”에 적용할 수 있습니다. 데코레이터는 <code>@expression</code> 형식으로 적용하는데, 여기에서 <code>expression</code> 은 반드시 <strong>함수</strong>여야 합니다. </p>
<p> 간단한 예로 <code>@firstDecorator</code> 라는 데코레이터를 클래스의 프로퍼티에 적용하고 싶다면 <code>findDecorator</code> 함수를 다음과 같이 작성하면 됩니다.</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">fistDecorator</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fistDecorator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    @fistDecorator
    job <span class="token operator">=</span> <span class="token string">'programmer'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>job<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>실행결과</p>
<pre class=" language-shell"><code class="language-shell">> fistDecorator
> programmer
</code></pre>
<h3 id="Decorator-Factory"><a href="#Decorator-Factory" class="headerlink" title="Decorator Factory"></a>Decorator Factory</h3><p> 위의 예제에서 <code>@firstDecorator</code> 데코레이터를 일반화해서 조금 더 다양한 상황에서 사용할 수 있도록 <strong>파라미터</strong>를 전달해야 할 수도 있습니다. 그러면 데코레이터 함수를 생성하는 함수인 <strong>데코레이터 팩토리</strong>를 작성하면 됩니다.</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">firstDecorator</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>'factory’<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'decorator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span>
    @<span class="token function">firstDecorator</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>
    prop <span class="token operator">=</span> ‘a'<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'인스턴스가 만들어지기 전'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SomeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>실행결과</p>
<pre class=" language-shell"><code class="language-shell">> factory
> decorator
> 인스턴스가 만들어지기 전
</code></pre>
<p> 실행 결과를 살펴보면 데코레이터는 클래스를 인스턴스화하기 위해 클래스를 호출하기 전에 실행됩니다. </p>
<h3 id="Decorator-조합하기"><a href="#Decorator-조합하기" class="headerlink" title="Decorator 조합하기"></a>Decorator 조합하기</h3><p>데코레이터의 또 다른 장점으로는 하나의 선언에 동시에 여러 개의 데코레이터를 적용할 수 있는 점이 있습니다.</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">decoA</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'decoA factory'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'decyA decorator'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">decoB</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'decoB decorator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">decoC</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'decoC factory'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'decoC decorator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span>
    @<span class="token function">decoA</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    @decoB
    @<span class="token function">decoC</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    prop <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>여러 개의 데코레이터가 적용될 때 실행되는 순서는 다음과 같습니다. </p>
<p>실행결과</p>
<pre class=" language-shell"><code class="language-shell">> decoA factory
> decoC factory
> decoC decorator
> decoB decorator
> decoA decorator
</code></pre>
<p>  <code>@expression</code> 에서 <code>expression</code> 표현식을 함수로 평가하는 순서는 <strong>“위에서 아래”</strong>입니다. 실행결과에서 <code>&quot;decoA factory&quot;</code> , <code>&quot;decoC factory&quot;</code> 만 출력되고 <code>&quot;decoB decorator&quot;</code> 가 출력되지 않은 이유는 <code>@decoB</code> 는 팩토리 함수가 없기 때문입니다.</p>
<p> 그리고 <code>expression</code> 이 함수로 평가된 후에 데코레이터 함수가 실행되는 순서는 <strong>“아래에서 위”</strong>입니다. 여기에서 말하는 데코레이터 함수란 <code>@decoA</code>, <code>@decoC</code>의 경우에는 팩토리 함수에서 반환하는 익명 함수이고, <code>@decoB</code>의 경우에는 <code>decoB</code> 함수입니다.</p>
<h2 id="Decorator-종류"><a href="#Decorator-종류" class="headerlink" title="Decorator 종류"></a>Decorator 종류</h2><p> 데코레이터는 클래스, 메서드, 프로퍼티, 접근자, 파라미터의 선언에 적용될 수 있습니다. 앞에서는 프로퍼티 데코레이터만을 예로 들었지만, 데코레이터가 어디에 적용되는지에 따라서, 데코레이터 함수로 넘어오는 인자의 길이나 구성이 달라집니다. 그래도 공통되는 부분도 있는데 공식 문서에 나와있는 것들을 추려보면 다음과 같습니다. </p>
<ul>
<li>데코레이터는 declaration 파일(<code>*.d.ts</code>), 혹은 <code>declare class</code> 안에서는 사용될 수 없습니다.</li>
<li>데코레이터 표현식은 런타임에 함수로서 호출됩니다.</li>
</ul>
<h3 id="Class-Decorator"><a href="#Class-Decorator" class="headerlink" title="Class Decorator"></a>Class Decorator</h3><p> 클래스 선언에 사용되는 클래스 데코레이터는 기존의 클래스 정의를 확장하는 용도로 사용할 수 있습니다. </p>
<p> 클래스 데코레이터 함수의 인자로는 <strong>클래스(생성자 함수)</strong>가 전달됩니다. 클래스 데코레이터 함수에서는 <strong>새로운 클래스(생성자 함수)</strong>만을 반환할 수 있고, 함수 외의 값들은 무시됩니다. </p>
<p> 다음은 타입스크립트 공식 문서에서 볼 수 있는 예제입니다.</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">function</span> classDecorator<span class="token operator">&lt;</span>T <span class="token keyword">extends</span> <span class="token punctuation">{</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">:</span><span class="token keyword">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">constructor</span><span class="token punctuation">:</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> <span class="token keyword">constructor</span> <span class="token punctuation">{</span>
      newProperty <span class="token operator">=</span> <span class="token string">"new property"</span><span class="token punctuation">;</span>
      hello <span class="token operator">=</span> <span class="token string">"override"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p> <code>@classDecorator</code> 데코레이터는 자신이 적용되는 클래스를 <code>extends</code>해서 새로운 프로퍼티를 추가하거나 기존의 프로퍼티를 오버라이드하는 역할을 합니다. </p>
<pre class=" language-typescript"><code class="language-typescript">@classDecorator
<span class="token keyword">class</span> <span class="token class-name">Greeter</span> <span class="token punctuation">{</span>
  property <span class="token operator">=</span> <span class="token string">"property"</span><span class="token punctuation">;</span>
  hello<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span>m<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>hello <span class="token operator">=</span> m<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Greeter</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment" spellcheck="true">// {property: "property", hello: "override", newProperty: "new property"}</span>
</code></pre>
<p> 실행결과를 보시면 <code>Greeter</code> 클래스에서 직접 선언하지 않았던 <code>newProperty</code> 프로퍼티가 추가되었고, <code>hello</code> 프로퍼티가 오버라이드된 것을 확인할 수 있습니다.</p>
<p> 위의 예제를 조금 응용해서 <code>@inject</code> 라는 데코레이터를 작성했습니다. 이 데코레이터는 “<em>클래스에 필요한 의존성을 클래스의 <code>constructor</code> 를 통해 주입(inject)</em>“하는 기능을 수행하게 했습니다.</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">const</span> dependencyPool <span class="token operator">=</span> <span class="token punctuation">{</span>
  dep1<span class="token punctuation">:</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'dep1'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  dep2<span class="token punctuation">:</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'dep2'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  dep3<span class="token punctuation">:</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'dep3'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  dep4<span class="token punctuation">:</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'dep4'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token operator">...</span>depNames<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token operator">&lt;</span>T <span class="token keyword">extends</span> <span class="token punctuation">{</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token keyword">constructor</span><span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> <span class="token keyword">constructor</span> <span class="token punctuation">{</span>
      <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> deps <span class="token operator">=</span> depNames<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>deps<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token operator">...</span>deps<span class="token punctuation">,</span>
          <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">:</span> dependencyPool<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">super</span><span class="token punctuation">(</span>deps<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p> <code>@inject</code> 데코레이터는  <code>dependencyPool</code> 이라는 객체로부터, <code>depNames</code> 으로 넘어오는 프로퍼티 이름을 가진 디펜던시만 골라 <code>@inject</code> 데코레이터가 적용된 클래스의 생성자 함수로 넘겨주는 역할을 합니다. </p>
<pre class=" language-typescript"><code class="language-typescript">@<span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'dep1'</span><span class="token punctuation">,</span> <span class="token string">'dep2'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span>deps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'product dependency is'</span><span class="token punctuation">,</span> deps<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createProduct</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token function">createProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment" spellcheck="true">// product dependency is {dep1: {…}, dep2: {…}}</span>
</code></pre>
<p> <code>@inject</code> 를 사용하여 <code>dependencyPool</code> 에서 <code>Product</code> 클래스에 필요한 의존성인 <code>&#39;dep1&#39;</code>, <code>&#39;dep2&#39;</code> 를 추가합니다. 그러면 <code>Product</code>가 인스턴스화되는 시점에서 필요한 의존성을 주입받을 수 있습니다. </p>
<h3 id="Method-Decorator"><a href="#Method-Decorator" class="headerlink" title="Method Decorator"></a>Method Decorator</h3><p> 메서드에 적용되는 데코레이터는 클래스와 마찬가지로 메서드의 기능을 확장할 수 있습니다. 클래스 데코레이터는 클래스(생성자 함수)를 <code>extends</code> 하는 방법으로 기능을 확장할 수 있었지만, 메서드 데코레이터는 메서드의 <strong>Property Descriptor</strong>를 수정하여 메서드를 확장합니다.</p>
<p> <strong>Property Descriptor</strong>는 객체의 프로퍼티들을 기존보다 정교하게 정의할 수 있는 ES5에서 처음 소개된 스펙입니다. 이 Property Descriptor는 <code>Object.getOwnPropertyDescriptor</code> 를 사용해서 가져올 수 있습니다.</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
  <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setPrice'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> descriptor <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>Product<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'setPrice'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment" spellcheck="true">// {value: ƒ, writable: true, enumerable: false, configurable: true}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">.</span>value <span class="token operator">===</span> Product<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>setPrice<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment" spellcheck="true">// true</span>
</code></pre>
<p> <code>descriptor</code> 에는 <code>value</code>, <code>enumerable</code> 등의 키가 들어있는 것을 확인할 수 있습니다. 여기에서 <code>value</code> 프로퍼티는 프로퍼티의 값이나 참조를 가지고 있는데, 마지막 출력 결과를 보면 <code>value</code>는  <code>setPrice</code> 함수에 대한 참조를 가리키고 있습니다. </p>
<blockquote>
<p>Property Descriptor는 ES5에서 처음 소개된 스펙이기 때문에 <code>tsconfig.json</code>의 <code>target</code>으로 가리키는 자바스크립트 버전이 <code>es5</code> 보다 낮게 되어있을 경우 Property Descriptor가 <code>undefined</code>으로 할당되어 사용할 수 없습니다.</p>
</blockquote>
<p> 다시 메서드 데코레이터로 돌아와서, 메서드 데코레이터의 함수는 3개의 인자를 받을 수 있습니다.</p>
<ol>
<li><code>static</code> 메서드라면 클래스의 생성자 함수, 인스턴스의 메서드라면 클래스의 <code>prototype</code> 객체</li>
<li>메서드 이름</li>
<li>메서드의 Property Descriptor</li>
</ol>
<p>그리고 Property Descriptor 형식의 객체를 반환할 수 있습니다. Property Descriptor 형식의 객체를 반환하지 않더라도 3번 째 인자로 넘어오는 객체를 수정하면 Property Descriptor를 반환하는 것과 같은 동작을 하게 됩니다.</p>
<p>예시로 작성한 <code>@logging</code> 데코레이터는 적용된 메서드에 넘어온 인자들과 메서드가 반환하는 값을 콘솔로 출력하게 됩니다. </p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">logging</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> originMethod <span class="token operator">=</span> descriptor<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  descriptor<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> originMethod<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> method arguments: `</span></span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> method return: `</span></span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p> <code>@logging</code> 데코레이터에서는 Property Descriptor를 직접 반환하지 않고, 인자로 넘어온 <code>descriptor</code> 객체를 직접 수정하는 방식으로 메서드 동작 방법을 변경하였습니다.</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
  price<span class="token punctuation">:</span> <span class="token keyword">number</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

  @logging
  <span class="token function">setPrice</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> p<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>price<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// setPrice method arguments:  [1000]</span>
<span class="token comment" spellcheck="true">// setPrice method return:  1000</span>
</code></pre>
<p><code>@logging</code> 데코레이터를 적용 후 <code>setPrice</code> 메서드를 호출하면 콘솔에 인자와 반환값이 기록되는 것을 확인할 수 있습니다.</p>
<h3 id="Accessor-Decorator"><a href="#Accessor-Decorator" class="headerlink" title="Accessor Decorator"></a>Accessor Decorator</h3><p> Accessor Decorator(접근자 데코레이터)는 <code>getter</code>, <code>setter</code> 에 적용되는 데코레이터를 말합니다. 데코레이터 함수에서는 메서드 데코레이터와 동일한 인자를 받습니다.</p>
<ol>
<li><code>static</code> 메서드라면 클래스의 생성자 함수, 인스턴스의 메서드라면 클래스의  <code>prototype</code> 객체</li>
<li>프로퍼티 이름</li>
<li>Property Descriptor</li>
</ol>
<p>접근자 데코레이터도 메서드 데코레이터처럼 인자로 넘어온 Property Descriptor를 변경하거나, 새로운 Property Descriptor를 반환해서 원래 접근자의 기능을 확장할 수 있습니다.</p>
<p>접근자 데코레이터에는 제약이 있는데, 하나의 프로퍼티에 대한 <code>get</code>, <code>set</code> 메서드에 동일한 데코레이터가 적용될 수 없습니다. 원래 자바스크립트에서는 하나의 프로퍼티가 <code>get</code>, <code>set</code>  메서드를 둘 다 가질 수 있습니다.</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
  _price<span class="token punctuation">:</span> <span class="token keyword">number</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

  <span class="token keyword">get</span> <span class="token function">price</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_price<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">set</span> <span class="token function">price</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_price <span class="token operator">=</span> p<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>price <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
</code></pre>
<p>그런데 타입스크립트에서는 <code>price</code> 프로퍼티에 동일한 데코레이터를 적용하려고 하면 컴파일 에러가 발생하고, 실행 결과를 보더라도 <code>get</code> 메서드에만 데코레이터가 적용된 것을 확인할 수 있습니다.</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">accessorDeco</span><span class="token punctuation">(</span>accessorType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'decorator for'</span><span class="token punctuation">,</span> accessorType<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
  _price<span class="token punctuation">:</span> <span class="token keyword">number</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

  @<span class="token function">accessorDeco</span><span class="token punctuation">(</span><span class="token string">'getter'</span><span class="token punctuation">)</span>
  <span class="token keyword">get</span> <span class="token function">price</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_price<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// Compile Error</span>
  <span class="token comment" spellcheck="true">// Decorators cannot be applied to multiple get/set accessors of the same name.</span>
  @<span class="token function">accessorDeco</span><span class="token punctuation">(</span><span class="token string">'setter'</span><span class="token punctuation">)</span>
  <span class="token keyword">set</span> <span class="token function">price</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_price <span class="token operator">=</span> p<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// decorator for getter</span>
</code></pre>
<p>타입스크립트 문서에서는 하나의 프로퍼티에 <code>get</code>, <code>set</code> 접근자가 모두 있고, 두 접근자에 동일한 데코레이터가 적용되었을 경우 소스코드 상에서 순서가 앞선 접근자에만 데코레이터가 적용된다고 나와있습니다. 이유는 접근자 데코레이터 또한 Property Descriptor에 적용되는데, 접근자의 Property Descriptor는 <code>get</code>, <code>set</code> 접근자를 모두 포함할 뿐 각 접근자에 대한 Property Descriptor가 없기 때문입니다.</p>
<p> 다음은 프로퍼티의 Property Descriptor를 변경 여부를 설정할 수 있게 해주는 <code>@configurable</code>입니다.</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">configurable</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token keyword">boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      descriptor<span class="token punctuation">.</span>configurable <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p> 단순히 Property Descriptor의 <code>configurable</code> 속성을 변경해주는 <code>@configurable</code> 데코레이터는, 앞에서 살펴 본 메서드 데코레이터로서도 적용될 수 있습니다.</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
  _price<span class="token punctuation">:</span> <span class="token keyword">number</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
  _count<span class="token punctuation">:</span> <span class="token keyword">number</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  @<span class="token function">configurable</span><span class="token punctuation">(</span><span class="token keyword">false</span><span class="token punctuation">)</span>
  <span class="token keyword">get</span> <span class="token function">price</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_price<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Product<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'new price getter!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_price<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// Uncaught TypeError: Cannot redefine property: price</span>
</code></pre>
<p> <code>Object.defineProperty</code> 로 <code>price</code> 의 속성을 변경하려고 하면 런타임 에러가 발생됩니다.</p>
<h3 id="Property-Decorator"><a href="#Property-Decorator" class="headerlink" title="Property Decorator"></a>Property Decorator</h3><p> 클래스의 프로퍼티 선언에 사용되는 프로퍼티 데코레이터는 두 개의 인자를 받습니다.</p>
<ol>
<li><code>static</code> 프로퍼티라면 클래스의 생성자 함수, 인스턴스 프로퍼티라면 클래스의 <code>prototype</code> 객체</li>
<li>프로퍼티 이름</li>
</ol>
<p>프로퍼티 데코레이터는 메서드 데코레이터와 다르게 데코레이터 함수에 Property Descriptor 가 인자로서 제공되지 않습니다. 대신에 프로퍼티 데코레이터는 Property Descriptor 형식의 객체를 반환해서 프로퍼티의 설정을 바꿀 수 있습니다. </p>
<blockquote>
<p>공식 문서의 프로퍼티 데코레이터를 설명하는 부분에서는 <code>&quot;the return value is ignored too&quot;</code>라고 되어있습니다. 이것을 보고 프로퍼티 데코레이터는 반환 값이 무시되는 줄 알았는데, 여러 예제를 살펴본 결과 프로퍼티 데코레이터에서  Property Descriptor 형식으로 객체를 반환할 때는, 프로퍼티에 정상적으로 적용되고 있었습니다. 처음에는 문서가 잘못된 것이 아닌가 생각했는데, 관련 이슈(<a href="https://github.com/microsoft/TypeScript/issues/32395)를" target="_blank" rel="noopener">https://github.com/microsoft/TypeScript/issues/32395)를</a> 읽어보니 의도된 문장이라고 합니다.</p>
</blockquote>
<p>아래는 <code>Product</code>의 <code>name</code>, <code>price</code> 프로퍼티에  <code>@readOnly</code> 데코레이터를 적용한 예제입니다. </p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">readOnly</span><span class="token punctuation">(</span>condition<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">decorator</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">any</span> <span class="token punctuation">{</span>  
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      writable<span class="token punctuation">:</span> condition <span class="token operator">?</span> <span class="token function">condition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>@readOnly</code> 데코레이터는 조건이 주어지면 해당 조건이 <code>true</code> 일 때만 프로퍼티를 read-only로 하고, 조건이 주어지지 않으면 무조건 read-only로 설정합니다.</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
  @<span class="token function">readOnly</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span> <span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  name<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span>

  @<span class="token function">readOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  price<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">,</span> price<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>
p1<span class="token punctuation">.</span>price <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// Cannot assign to read only property 'price' of object '#&lt;Product>'</span>
</code></pre>
<p><code>name</code> 프로퍼티는 2020년 1월 1일이 넘어가면 read-only가 되도록 처리되었고, <code>price</code> 프로퍼티는 무조건 read-only가 되어 값을 할당할 경우 에러가 발생하게 됩니다. </p>
<h3 id="Parameter-Decorator"><a href="#Parameter-Decorator" class="headerlink" title="Parameter Decorator"></a>Parameter Decorator</h3><p>함수의 파라미터에 사용되는 파라미터 데코레이터는 세 개의 인자를 받고, 반환값은 무시됩니다. 세 개의 인자는 다음과 같습니다.</p>
<ol>
<li>static 메서드의 파라미터 데코레이터라면 클래스의 생성자 함수, 인스턴스의 메서드라면 <code>prototype</code> 객체</li>
<li>파라미터 데코레이터가 적용된 메서드의 이름</li>
<li>메서드 파라미터 목록에서의 index</li>
</ol>
<p>아래는 메서드 데코레이터인 <code>@validate</code>와 파라미터 데코레이터인 <code>@minNumber</code>를 작성한 예제입니다. </p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">minNumber</span><span class="token punctuation">(</span>min<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">decorator</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">.</span>validators <span class="token operator">=</span> <span class="token punctuation">{</span>
      minNumber<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> args<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">>=</span> min<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">validate</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> originMethod <span class="token operator">=</span> target<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
  descriptor<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>validators<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>key <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>target<span class="token punctuation">.</span>validators<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Not Valid!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    originMethod<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<blockquote>
<p>공식 문서와 다른 자료를 찾아본 결과 파라미터 데코레이터는 다른 데코레이터들처럼 단독으로 사용되는 경우보다 메서드 데코레이터와 함께 사용되는 경우가 많았습니다. 예제 코드를 작성하면서도 파라미터 데코레이터는 메서드 데코레이터와 함께 사용하면 더 좋겠다는 생각이 들었습니다. </p>
</blockquote>
<p><code>@minNumber</code> 파라미터 데코레이터는 파라미터의 최소값을 검사하기 위한 데코레이터입니다. 우선 클래스의 <code>prototype</code> 객체에 <code>validators</code>라는 객체를 만들고, 이 객체에 파라미터를 검증하기 위한 함수를 추가합니다.</p>
<p>그리고 <code>@validate</code> 메서드 데코레이터에서는 <code>prototype.validators</code>에 있는 함수들을 실행하는데, 파라미터 데코레이터 함수 안에서 파라미터의 값을 알 수 있도록 전체 인자 목록 <code>args</code>을 넘겨줍니다.</p>
<pre class=" language-typescript"><code class="language-typescript">
<span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span>
  price<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">;</span>
  purchased<span class="token punctuation">:</span> <span class="token keyword">number</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">,</span> price<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @validate
  <span class="token keyword">public</span> <span class="token function">setPrice</span><span class="token punctuation">(</span>@<span class="token function">minNumber</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span> price<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p1<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p1<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token number">2001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p1<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// Uncaught Error: Not Valid!</span>
</code></pre>
<p><code>Product</code> 클래스에 <code>@validate</code> 데코레이터와 <code>minNumber</code> 데코레이터를 적용하였습니다. 실행 결과를 보면 <code>setPrice</code> 메서드에 2000, 2001을 넘겨줄 때는 잘 실행되지만, 2000보다 작은 1000을 넘겨줄 경우 에러가 발생하는 것을 확인할 수 있습니다. </p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/03/31/introduction-gulp/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'haeguri';
var disqus_identifier = '2019/08/25/typescript-decorator/';
var disqus_title = '타입스크립트의 Decorator 살펴보기';
var disqus_url = 'https://haeguri.github.io/2019/08/25/typescript-decorator/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//haeguri.disqus.com/count.js" async></script><div class="copyright"><p>© 2018 - 2019 <a href="https://haeguri.github.io">Haegyun Jung</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-56205180-3",'auto');ga('send','pageview');</script></body></html>